<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>HelloNotes - Invoice</title>

<!-- Google font -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
  :root{
    --brand:#CD9703;
    --accent:#a35cff;
    --green:#000435;
  }
  *{box-sizing:border-box}
  body{
    font-family:'Poppins',sans-serif;
    background:#f0f4ff;
    margin:16px;
    -webkit-print-color-adjust:exact;
  }

  /* A4-friendly container width (paper width minus margins) */
  .invoice {
    width:190mm;
    max-width:100%;
    margin: 0 auto;
    background:#fff;
    padding:12mm;
    border-radius:8px;
    box-shadow:0 8px 30px rgba(10,30,80,0.06);
  }

  .header {
    display:flex;
    gap:12px;
    align-items:flex-start;
    border-bottom:6px solid var(--brand);
    padding-bottom:0;
  }

  .logo {
    width:auto; /* Medium size as requested */
    height:auto;
    border-radius:0;
    overflow:hidden;
    display:inline-block;
    margin:0;
    padding:0;
    align-items:center;
    justify-content:center;
    background:transparent;
    box-shadow:0 4px 10px rgba(0,0,0,0.04);
  }
  .logo img{ max-width:150px; max-height:120px; width:auto; height:auto display:block; }

  .company {
    flex:1;
  }
  .company h2{ margin:0; color:var(--brand); font-size:28px; }
  .company p{ margin:0; padding:0; color:#333; font-size:15px; }

  .controls { display:flex; gap:8px; align-items:center; }

  .meta {
    display:flex;
    gap:12px;
    margin-top:10px;
    flex-wrap:wrap;
  }
  .meta .field {
    min-width:170px;
  }
  label{ font-weight:600; font-size:13px; color:#222; display:block; }
  input[type="text"], input[type="date"], input[type="number"]{
    margin-top:6px;
    padding:8px 10px;
    border-radius:8px;
    border:1px solid #cfcfcf;
    width:100%;
    font-size:14px;
  }

  /* Items table */
  table{ width:100%; border-collapse:collapse; margin-top:14px; table-layout:fixed;}
  thead th{
    background:linear-gradient(90deg,var(--brand),#2f6eea);
    color:#fff; padding:10px; text-align:left; font-size:13px;
  }
  tbody td{ padding:10px; border-bottom:1px solid #eee; font-size:14px; vertical-align:middle; }
  td.desc{ width:54%; }
  td.qty, td.rate, td.amount { width:14%; text-align:right; }
  .small-btn{ font-size:13px; padding:6px 8px; border-radius:8px; border:1px solid #cfcfcf; background:#fff; cursor:pointer;}

  .table-actions{ display:flex; justify-content:space-between; margin-top:8px; align-items:center;}

  /* Totals */
  .totals { display:flex; justify-content:flex-end; margin-top:18px; }
  .totals .card { width:320px; background:#fbfbfe; padding:12px; border-radius:8px; border:1px solid #f0f0f5; }
  .tot-row{ display:flex; justify-content:space-between; padding:6px 0; font-size:15px; }
  .final-row{ display:flex; justify-content:space-between; padding-top:8px; font-size:18px; font-weight:700; border-top:1px dashed #e6e6f0; margin-top:6px; }

  /* Actions row */
  .actions { display:flex; justify-content:space-between; align-items:center; margin-top:18px; gap:8px; flex-wrap:wrap; }
  .btn-primary{ background:var(--green); color:#fff; border:none; padding:10px 16px; border-radius:8px; cursor:pointer; font-weight:600;}
  .btn-secondary{ background:#fff; border:1px solid #cfcfcf; padding:9px 12px; border-radius:8px; cursor:pointer; }

  /* hide during PDF generation */
  .hide-on-pdf{ display:inline-flex; }

  /* signature */
  .signature { margin-top:26px; width:320px; border-top:2px solid var(--brand); padding-top:8px; text-align:center; font-weight:600; color:#333; }

  @media print{
    body{ background:transparent; margin:0; }
    .invoice{ box-shadow:none; border-radius:0; padding:10mm; }
    .hide-on-pdf{ display:none !important; }
  }

  @media (max-width:720px){
    .meta{ flex-direction:column; }
    .totals .card{ width:100%; }
  }
</style>
</head>
<body>

<div class="invoice" id="invoiceRoot">

  <!-- header -->
  <div class="header">
    <div class="logo">
      <img id="logoImg" src="logo/LOGO.jpg" alt="Logo (Upload)" />
    </div>

    <div class="company">
      <h2>HELLO NOTES</h2>
      <p>Phone: 8073431538</p>
      <p>No.6 Kurubarahalli Main Road, Kirloskar Layout, Bengaluru - 570079</p>
    </div>

    <div class="controls hide-on-pdf">
      <label style="cursor:pointer;">
        <input id="logoInput" type="file" accept="image/*" style="display:none">
        <span class="small-btn">Choose Logo</span>
      </label>
    </div>
  </div>

  <!-- meta fields -->
  <div class="meta">
    <div class="field">
      <label>Invoice #</label>
      <input id="invoiceNo" type="text" value="INV-20251211">
    </div>

    <div class="field">
      <label>Date</label>
      <input id="invoiceDate" type="date">
    </div>

    <div class="field">
      <label>Customer Name</label>
      <input id="customerName" type="text" placeholder="Enter customer name">
    </div>
  </div>

  <!-- items -->
  <table id="itemsTable" aria-label="Invoice items">
    <thead>
      <tr>
        <th>Item description</th>
        <th style="text-align:right">Qty</th>
        <th style="text-align:right">Rate (₹)</th>
        <th style="text-align:right">Amount (₹)</th>
        <th class="hide-on-pdf" style="width:70px;"></th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="desc"><input class="in-desc" type="text" value="Star" style="width:100%; border:0; outline:none;"></td>
        <td class="qty"><input class="in-qty" type="number" min="0" value="6" style="width:80%; text-align:right; border:0;"></td>
        <td class="rate"><input class="in-rate" type="number" min="0" value="200" style="width:80%; text-align:right; border:0;"></td>
        <td class="amount" style="text-align:right">1200.00</td>
        <td class="hide-on-pdf" style="text-align:center"><button class="small-btn" onclick="removeRow(this)">Remove</button></td>
      </tr>
      <tr>
        <td class="desc"><input class="in-desc" type="text" value="Grass hara" style="width:100%; border:0; outline:none;"></td>
        <td class="qty"><input class="in-qty" type="number" min="0" value="10" style="width:80%; text-align:right; border:0;"></td>
        <td class="rate"><input class="in-rate" type="number" min="0" value="50" style="width:80%; text-align:right; border:0;"></td>
        <td class="amount" style="text-align:right">500.00</td>
        <td class="hide-on-pdf" style="text-align:center"><button class="small-btn" onclick="removeRow(this)">Remove</button></td>
      </tr>
    </tbody>
  </table>

  <div class="table-actions">
    <div>
      <button class="small-btn hide-on-pdf" onclick="addRow()">+ Add Item</button>
    </div>

    <!-- discount inputs -->
    <div style="display:flex; gap:8px; align-items:center;">
      <div style="text-align:right;">
        <label style="font-weight:600; font-size:13px;">Discount (%)</label>
        <input id="discPct" type="number" min="0" max="100" value="0" style="width:90px; margin-top:6px;" />
      </div>
      <div style="text-align:right;">
        <label style="font-weight:600; font-size:13px;">Discount (₹)</label>
        <input id="discRupee" type="number" min="0" value="0" style="width:120px; margin-top:6px;" />
      </div>
    </div>
  </div>

  <!-- totals -->
  <div class="totals">
    <div class="card">
      <div class="tot-row"><div>Subtotal</div><div id="subtotal">₹ 0.00</div></div>
      <div class="tot-row"><div>Discount</div><div id="discountDisplay">- ₹ 0.00</div></div>
      <div class="final-row"><div>Grand Total</div><div id="grandTotal">₹ 0.00</div></div>
    </div>
  </div>

  <!-- signature -->
  <div class="signature">Authorized Signature</div>

  <!-- actions -->
  <div class="actions">
    <div style="font-size:13px; color:#666">Changes are live — edit quantities/rates or add rows.</div>

    <div>
      <button id="printBtn" class="btn-secondary hide-on-pdf" onclick="window.print()">Print</button>
      <button id="downloadBtn" class="btn-primary hide-on-pdf">Download PDF</button>
    </div>
  </div>

</div>

<!-- html2pdf -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>

<script>
  // initialize date
  (function(){ const d=new Date(); document.getElementById('invoiceDate').value = d.toISOString().split('T')[0]; })();

  // logo upload (medium size)
  const logoInput = document.getElementById('logoInput');
  const logoImg = document.getElementById('logoImg');
  logoImg.src = ''; // default empty; user will upload from system

  logoInput.addEventListener('change', function(e){
    const f = e.target.files[0];
    if(!f) return;
    const reader = new FileReader();
    reader.onload = function(evt){ logoImg.src = evt.target.result; };
    reader.readAsDataURL(f);
  });

  // add / remove rows
  function addRow(){
    const tbody = document.querySelector('#itemsTable tbody');
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="desc"><input class="in-desc" type="text" value="New Item" style="width:100%; border:0; outline:none;"></td>
      <td class="qty"><input class="in-qty" type="number" min="0" value="1" style="width:80%; text-align:right; border:0;"></td>
      <td class="rate"><input class="in-rate" type="number" min="0" value="0" style="width:80%; text-align:right; border:0;"></td>
      <td class="amount" style="text-align:right">0.00</td>
      <td class="hide-on-pdf" style="text-align:center"><button class="small-btn" onclick="removeRow(this)">Remove</button></td>
    `;
    tbody.appendChild(tr);
    attachInputs(tr);
    recalc();
  }

  function removeRow(btn){
    const tr = btn.closest('tr');
    if(!tr) return;
    tr.remove();
    recalc();
  }

  // attach input events for an existing row
  function attachInputs(tr){
    const qty = tr.querySelector('.in-qty');
    const rate = tr.querySelector('.in-rate');
    [qty, rate].forEach(i => {
      if(i) i.addEventListener('input', recalc);
      if(i) i.addEventListener('blur', recalc);
    });
  }

  // attach for initial rows
  document.querySelectorAll('#itemsTable tbody tr').forEach(r => attachInputs(r));

  // discount inputs
  document.getElementById('discPct').addEventListener('input', recalc);
  document.getElementById('discRupee').addEventListener('input', recalc);

  // recalc function (auto calculations)
  function recalc(){
    const rows = document.querySelectorAll('#itemsTable tbody tr');
    let subtotal = 0;
    rows.forEach(r=>{
      const qEl = r.querySelector('.in-qty');
      const rateEl = r.querySelector('.in-rate');
      const qty = parseFloat(qEl?.value) || 0;
      const rate = parseFloat(rateEl?.value) || 0;
      const amt = +(qty * rate);
      const amtCell = r.querySelector('.amount');
      amtCell.innerText = amt.toFixed(2);
      subtotal += amt;
    });

    // Discount logic (Option A):
    // If rupee discount > 0 => use rupee discount
    // else if percent > 0 => use percentage
    // else -> 0

    const discR = parseFloat(document.getElementById('discRupee').value) || 0;
    const discP = parseFloat(document.getElementById('discPct').value) || 0;

    let discountAmount = 0;
    if(discR > 0){
      discountAmount = discR;
    } else if(discP > 0){
      discountAmount = +(subtotal * (discP/100));
    } else {
      discountAmount = 0;
    }

    // Prevent negative totals
    if(discountAmount > subtotal) discountAmount = subtotal;

    const grand = +(subtotal - discountAmount);

    document.getElementById('subtotal').innerText = '₹ ' + subtotal.toLocaleString('en-IN', {minimumFractionDigits:2, maximumFractionDigits:2});
    document.getElementById('discountDisplay').innerText = '- ₹ ' + discountAmount.toLocaleString('en-IN', {minimumFractionDigits:2, maximumFractionDigits:2});
    document.getElementById('grandTotal').innerText = '₹ ' + grand.toLocaleString('en-IN', {minimumFractionDigits:2, maximumFractionDigits:2});
  }

  // initial calc
  recalc();

  // keep live recalc when user types inside table cells (for dynamically added elements)
  document.querySelector('#itemsTable').addEventListener('input', recalc);
  document.querySelector('#itemsTable').addEventListener('change', recalc);

  // Download PDF (hide controls while generating)
  const downloadBtn = document.getElementById('downloadBtn');
  downloadBtn.addEventListener('click', function(){
    const hidables = document.querySelectorAll('.hide-on-pdf');
    hidables.forEach(el => el.style.display = 'none');

    // small timeout to allow reflow
    setTimeout(() => {
      const opt = {
        margin: [8, 8, 10, 8], // mm top,left,bottom,right
        filename: 'HelloNotes_Invoice_' + (document.getElementById('invoiceNo').value || '0000') + '.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true, scrollY: -window.scrollY },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
      };

      html2pdf().set(opt).from(document.getElementById('invoiceRoot')).save()
        .then(()=> hidables.forEach(el => el.style.display = 'inline-flex'))
        .catch((err)=>{ console.error(err); hidables.forEach(el => el.style.display = 'inline-flex'); });
    }, 160);
  });

  // prevent Enter adding newlines in inputs (optional)
  document.addEventListener('keydown', function(e){
    if(e.key === 'Enter'){
      const el = document.activeElement;
      if(el && (el.classList.contains('in-qty') || el.classList.contains('in-rate') || el.classList.contains('in-desc'))){
        e.preventDefault();
        recalc();
      }
    }
  });

</script>
</body>
</html>